<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables, TypeApplications, TupleSections #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |Module `TuringMachine.Optimization` include functions for reducing size of</span><span>
</span><span id="line-4"></span><span class="hs-comment">--  Turing machine with saving of functionality.</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TuringMachine.Optimization</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="TuringMachine.Optimization.html#optimize"><span class="hs-identifier">optimize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="TuringMachine.Optimization.html#optimal"><span class="hs-identifier">optimal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="TuringMachine.Optimization.html#ifCanOptimize"><span class="hs-identifier">ifCanOptimize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="TuringMachine.Optimization.html#safeOptimize"><span class="hs-identifier">safeOptimize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="TuringMachine.Optimization.html#safeOptimal"><span class="hs-identifier">safeOptimal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="TuringMachine.Optimization.html#ifCanSafeOptimize"><span class="hs-identifier">ifCanSafeOptimize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="TuringMachine.Optimization.html#DiffTM"><span class="hs-identifier">DiffTM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="TuringMachine.Optimization.html#diffTM"><span class="hs-identifier">diffTM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html"><span class="hs-identifier">TuringMachine.Optimization.Level</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Safe.html"><span class="hs-identifier">TuringMachine.Optimization.Safe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="TuringMachine.html"><span class="hs-identifier">TuringMachine</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html"><span class="hs-identifier">TuringMachine.Optimization.Level</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Safe.html"><span class="hs-identifier">TuringMachine.Optimization.Safe</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="TuringMachine.html"><span class="hs-identifier">TuringMachine</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="TuringMachine.Constructors.html"><span class="hs-identifier">TuringMachine.Constructors</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Containers.Set.html"><span class="hs-identifier">Containers.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">findMin</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">deleteMin</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Containers.Map.html"><span class="hs-identifier">Containers.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromListWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapWithKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Lazy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runState</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">execStateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">swap</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">maximumBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Containers.ListUtils</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nubOrd</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">type</span><span> </span><span id="TMConverting"><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-var">TMConverting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST.StateT</span></span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST.State</span></span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#IsChanged"><span class="hs-identifier hs-type">IsChanged</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">type</span><span> </span><span id="IsChanged"><span class="annot"><a href="TuringMachine.Optimization.html#IsChanged"><span class="hs-identifier hs-var">IsChanged</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><a href="TuringMachine.Optimization.html#isChanged"><span class="hs-identifier hs-type">isChanged</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-41"></span><span id="isChanged"><span class="annot"><span class="annottext">isChanged :: TMConverting
</span><a href="TuringMachine.Optimization.html#isChanged"><span class="hs-identifier hs-var hs-var">isChanged</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State IsChanged () -&gt; TMConverting
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(State IsChanged () -&gt; TMConverting)
-&gt; State IsChanged () -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IsChanged -&gt; State IsChanged ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="annot"><a href="TuringMachine.Optimization.html#isn%27tChanged"><span class="hs-identifier hs-type">isn'tChanged</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-44"></span><span id="isn%27tChanged"><span class="annot"><span class="annottext">isn'tChanged :: TMConverting
</span><a href="TuringMachine.Optimization.html#isn%27tChanged"><span class="hs-identifier hs-var hs-var">isn'tChanged</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State IsChanged () -&gt; TMConverting
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(State IsChanged () -&gt; TMConverting)
-&gt; State IsChanged () -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IsChanged -&gt; State IsChanged ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="annot"><a href="TuringMachine.Optimization.html#ifIsChanged"><span class="hs-identifier hs-type">ifIsChanged</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-47"></span><span id="ifIsChanged"><span class="annot"><span class="annottext">ifIsChanged :: TMConverting -&gt; TMConverting
</span><a href="TuringMachine.Optimization.html#ifIsChanged"><span class="hs-identifier hs-var hs-var">ifIsChanged</span></a></span></span><span> </span><span id="local-6989586621679339031"><span class="annot"><span class="annottext">TMConverting
</span><a href="#local-6989586621679339031"><span class="hs-identifier hs-var">tmConv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-48"></span><span>    </span><span id="local-6989586621679339030"><span class="annot"><span class="annottext">IsChanged
</span><a href="#local-6989586621679339030"><span class="hs-identifier hs-var">changed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State IsChanged IsChanged
-&gt; StateT TuringMachine (State IsChanged) IsChanged
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">State IsChanged IsChanged
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">IsChanged -&gt; TMConverting -&gt; TMConverting
forall (f :: * -&gt; *). Applicative f =&gt; IsChanged -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><a href="#local-6989586621679339030"><span class="hs-identifier hs-var">changed</span></a></span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><span class="annottext">TMConverting
</span><a href="#local-6989586621679339031"><span class="hs-identifier hs-var">tmConv</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="annot"><a href="TuringMachine.Optimization.html#infinityConverting"><span class="hs-identifier hs-type">infinityConverting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-53"></span><span id="infinityConverting"><span class="annot"><span class="annottext">infinityConverting :: TMConverting -&gt; TMConverting
</span><a href="TuringMachine.Optimization.html#infinityConverting"><span class="hs-identifier hs-var hs-var">infinityConverting</span></a></span></span><span> </span><span id="local-6989586621679339028"><span class="annot"><span class="annottext">TMConverting
</span><a href="#local-6989586621679339028"><span class="hs-identifier hs-var">tmConv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#isn%27tChanged"><span class="hs-identifier hs-var">isn'tChanged</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">TMConverting
</span><a href="#local-6989586621679339028"><span class="hs-identifier hs-var">tmConv</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="annottext">TMConverting -&gt; TMConverting
</span><a href="TuringMachine.Optimization.html#ifIsChanged"><span class="hs-identifier hs-var">ifIsChanged</span></a></span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; TMConverting) -&gt; TMConverting -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><span class="annottext">TMConverting -&gt; TMConverting
</span><a href="TuringMachine.Optimization.html#infinityConverting"><span class="hs-identifier hs-var">infinityConverting</span></a></span><span> </span><span class="annot"><span class="annottext">TMConverting
</span><a href="#local-6989586621679339028"><span class="hs-identifier hs-var">tmConv</span></a></span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#isChanged"><span class="hs-identifier hs-var">isChanged</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="annot"><a href="TuringMachine.Optimization.html#removeUselessQuadruples"><span class="hs-identifier hs-type">removeUselessQuadruples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-61"></span><span id="removeUselessQuadruples"><span class="annot"><span class="annottext">removeUselessQuadruples :: TMConverting
</span><a href="TuringMachine.Optimization.html#removeUselessQuadruples"><span class="hs-identifier hs-var hs-var">removeUselessQuadruples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621679339026"><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679339026"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
-&gt; StateT TuringMachine (State IsChanged) Quadruples
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span id="local-6989586621679339023"><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679339023"><span class="hs-identifier hs-var">allQs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting (Set State) TuringMachine (Set State)
-&gt; StateT TuringMachine (State IsChanged) (Set State)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting (Set State) TuringMachine (Set State)
TMGetter (Set State)
</span><a href="TuringMachine.html#allStates"><span class="hs-identifier hs-var">allStates</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679339021"><span class="annot"><span class="annottext">qsWithM :: Quadruples
</span><a href="#local-6989586621679339021"><span class="hs-identifier hs-var hs-var">qsWithM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-65"></span><span>            </span><span class="annot"><span class="annottext">Predicate QuadrupleToPart
</span><a href="#local-6989586621679339020"><span class="hs-identifier hs-var">withAnyMove</span></a></span><span> </span><span class="annot"><span class="annottext">Predicate QuadrupleToPart -&gt; Quadruples -&gt; Quadruples
forall c v. Filterable c v =&gt; (v -&gt; IsChanged) -&gt; c -&gt; c
</span><a href="Containers.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679339026"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-66"></span><span>        </span><span id="local-6989586621679339018"><span class="annot"><span class="annottext">statesToM :: Set State
</span><a href="#local-6989586621679339018"><span class="hs-identifier hs-var hs-var">statesToM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-67"></span><span>            </span><span class="annot"><span class="annottext">Map QuadrupleFromPart State -&gt; Set State
forall c v. (Valuable c v, Ord v) =&gt; c -&gt; Set v
</span><a href="Containers.html#valuesSet"><span class="hs-identifier hs-var">valuesSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Map QuadrupleFromPart State -&gt; Set State)
-&gt; Map QuadrupleFromPart State -&gt; Set State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QuadrupleToPart -&gt; State
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(QuadrupleToPart -&gt; State)
-&gt; Quadruples -&gt; Map QuadrupleFromPart State
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679339021"><span class="hs-identifier hs-var">qsWithM</span></a></span><span>
</span><span id="line-68"></span><span>        </span><span id="local-6989586621679339015"><span class="annot"><span class="annottext">statesToS :: Set State
</span><a href="#local-6989586621679339015"><span class="hs-identifier hs-var hs-var">statesToS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>            </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679339023"><span class="hs-identifier hs-var">allQs</span></a></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; Set State -&gt; Set State
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%5C"><span class="hs-operator hs-var">\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679339018"><span class="hs-identifier hs-var">statesToM</span></a></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; Set State -&gt; Set State
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%5C"><span class="hs-operator hs-var">\\</span></a></span><span> </span><span class="annot"><span class="annottext">[State] -&gt; Set State
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">State
</span><a href="TuringMachine.State.html#startState"><span class="hs-identifier hs-var">startState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="TuringMachine.State.html#finalState"><span class="hs-identifier hs-var">finalState</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-70"></span><span>        </span><span id="local-6989586621679339010"><span class="annot"><span class="annottext">loops :: Quadruples
</span><a href="#local-6989586621679339010"><span class="hs-identifier hs-var hs-var">loops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>            </span><span class="annot"><span class="annottext">Predicate Quadruple
</span><a href="#local-6989586621679339009"><span class="hs-identifier hs-var">isLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Predicate Quadruple -&gt; Quadruples -&gt; Quadruples
forall c v. Filterable c v =&gt; (v -&gt; IsChanged) -&gt; c -&gt; c
</span><a href="Containers.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679339026"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-72"></span><span>        </span><span id="local-6989586621679339008"><span class="annot"><span class="annottext">qsToStatesToS :: Quadruples
</span><a href="#local-6989586621679339008"><span class="hs-identifier hs-var hs-var">qsToStatesToS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set State -&gt; Predicate QuadrupleToPart
</span><a href="#local-6989586621679339007"><span class="hs-identifier hs-var">stateToFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679339015"><span class="hs-identifier hs-var">statesToS</span></a></span><span> </span><span class="annot"><span class="annottext">Predicate QuadrupleToPart -&gt; Quadruples -&gt; Quadruples
forall c v. Filterable c v =&gt; (v -&gt; IsChanged) -&gt; c -&gt; c
</span><a href="Containers.html#%3C%3F%3E"><span class="hs-operator hs-var">&lt;?&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679339026"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; Quadruples -&gt; Quadruples
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%5C"><span class="hs-operator hs-var">\\</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679339010"><span class="hs-identifier hs-var">loops</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span id="local-6989586621679339006"><span class="annot"><span class="annottext">[QuadrupleFromPart]
</span><a href="#local-6989586621679339006"><span class="hs-identifier hs-var">statesAndSymbolsToS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-75"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="TuringMachine.SymbolOrMove.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679339004"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679339004"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679339003"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679339003"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679339003"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679339004"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QuadrupleToPart -&gt; QuadrupleFromPart)
-&gt; [QuadrupleToPart] -&gt; [QuadrupleFromPart]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; [QuadrupleToPart]
forall c v. Valuable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#values"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679339008"><span class="hs-identifier hs-var">qsToStatesToS</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span id="local-6989586621679339001"><span class="annot"><span class="annottext">Map State (Set Symbol)
</span><a href="#local-6989586621679339001"><span class="hs-identifier hs-var">statesWithSymbolsToS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-77"></span><span>            </span><span class="annot"><span class="annottext">(Set Symbol -&gt; Set Symbol -&gt; Set Symbol)
-&gt; [(State, Set Symbol)] -&gt; Map State (Set Symbol)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; Set Symbol -&gt; Set Symbol
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%2F"><span class="hs-operator hs-var">(\/)</span></a></span><span> </span><span class="annot"><span class="annottext">([(State, Set Symbol)] -&gt; Map State (Set Symbol))
-&gt; [(State, Set Symbol)] -&gt; Map State (Set Symbol)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QuadrupleFromPart -&gt; (State, Set Symbol))
-&gt; [QuadrupleFromPart] -&gt; [(State, Set Symbol)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Symbol -&gt; Identity (Set Symbol))
-&gt; QuadrupleFromPart -&gt; Identity (State, Set Symbol)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((Symbol -&gt; Identity (Set Symbol))
 -&gt; QuadrupleFromPart -&gt; Identity (State, Set Symbol))
-&gt; (Symbol -&gt; Set Symbol)
-&gt; QuadrupleFromPart
-&gt; (State, Set Symbol)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Set Symbol
forall c v. Singletonable c v =&gt; v -&gt; c
</span><a href="Containers.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[QuadrupleFromPart]
</span><a href="#local-6989586621679339006"><span class="hs-identifier hs-var">statesAndSymbolsToS</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span id="local-6989586621679338996"><span class="annot"><span class="annottext">QuadrupleFromPart -&gt; IsChanged
</span><a href="#local-6989586621679338996"><span class="hs-identifier hs-var">predicate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-79"></span><span>            </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679338995"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338995"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338994"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338994"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsChanged -&gt; Maybe IsChanged -&gt; IsChanged
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(Maybe IsChanged -&gt; IsChanged) -&gt; Maybe IsChanged -&gt; IsChanged
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-80"></span><span>                </span><span id="local-6989586621679338993"><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338993"><span class="hs-identifier hs-var">symbolsToS</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map State (Set Symbol)
</span><a href="#local-6989586621679339001"><span class="hs-identifier hs-var">statesWithSymbolsToS</span></a></span><span> </span><span class="annot"><span class="annottext">Map State (Set Symbol) -&gt; State -&gt; Maybe (Set Symbol)
forall c k v (m :: * -&gt; *).
(Indexable c k v, MonadFail m) =&gt;
c -&gt; k -&gt; m v
</span><a href="Containers.html#%21%3F"><span class="hs-operator hs-var">!?</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338995"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-81"></span><span>                </span><span class="annot"><span class="annottext">IsChanged -&gt; Maybe IsChanged
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(IsChanged -&gt; Maybe IsChanged) -&gt; IsChanged -&gt; Maybe IsChanged
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338994"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Set Symbol -&gt; IsChanged
forall c v. Containable c v =&gt; v -&gt; c -&gt; IsChanged
</span><a href="Containers.html#member"><span class="hs-operator hs-var">`member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338993"><span class="hs-identifier hs-var">symbolsToS</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">(Quadruples -&gt; Identity Quadruples)
-&gt; TuringMachine -&gt; Identity TuringMachine
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span> </span><span class="annot"><span class="annottext">((Quadruples -&gt; Identity Quadruples)
 -&gt; TuringMachine -&gt; Identity TuringMachine)
-&gt; (QuadrupleFromPart -&gt; IsChanged) -&gt; TMConverting
forall c v s (m :: * -&gt; *).
(Filterable c v, MonadState s m) =&gt;
ASetter s s c c -&gt; (v -&gt; IsChanged) -&gt; m ()
</span><a href="Containers.html#%3C%3F%3E%3D"><span class="hs-operator hs-var">&lt;?&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">QuadrupleFromPart -&gt; IsChanged
</span><a href="#local-6989586621679338996"><span class="hs-identifier hs-var">predicate</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679338989"><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338989"><span class="hs-identifier hs-var">qs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
-&gt; StateT TuringMachine (State IsChanged) Quadruples
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">IsChanged -&gt; TMConverting -&gt; TMConverting
forall (f :: * -&gt; *). Applicative f =&gt; IsChanged -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quadruples -&gt; Int
forall c. Sizable c =&gt; c -&gt; Int
</span><a href="Containers.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679339026"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IsChanged
forall a. Ord a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; Int
forall c. Sizable c =&gt; c -&gt; Int
</span><a href="Containers.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338989"><span class="hs-identifier hs-var">qs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#isChanged"><span class="hs-identifier hs-var">isChanged</span></a></span><span>
</span><span id="line-86"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><a href="#local-6989586621679339009"><span class="hs-identifier hs-type">isLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#Predicate"><span class="hs-identifier hs-type">Predicate</span></a></span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#Quadruple"><span class="hs-identifier hs-type">Quadruple</span></a></span><span>
</span><span id="line-88"></span><span>        </span><span id="local-6989586621679339009"><span class="annot"><span class="annottext">isLoop :: Predicate Quadruple
</span><a href="#local-6989586621679339009"><span class="hs-identifier hs-var hs-var">isLoop</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679338986"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338986"><span class="hs-identifier hs-var">q1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338985"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338985"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679338984"><span class="annot"><span class="annottext">MoveOr Symbol
</span><a href="#local-6989586621679338984"><span class="hs-identifier hs-var">sm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338983"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338983"><span class="hs-identifier hs-var">q2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338986"><span class="hs-identifier hs-var">q1</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; IsChanged
forall a. Eq a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338983"><span class="hs-identifier hs-var">q2</span></a></span><span> </span><span class="annot"><span class="annottext">IsChanged -&gt; IsChanged -&gt; IsChanged
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">MoveOr Symbol
</span><a href="#local-6989586621679338984"><span class="hs-identifier hs-var">sm</span></a></span><span> </span><span class="annot"><span class="annottext">MoveOr Symbol -&gt; MoveOr Symbol -&gt; IsChanged
forall a. Eq a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; MoveOr Symbol
forall s. s -&gt; MoveOr s
</span><a href="TuringMachine.SymbolOrMove.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338985"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><a href="#local-6989586621679339020"><span class="hs-identifier hs-type">withAnyMove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#Predicate"><span class="hs-identifier hs-type">Predicate</span></a></span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#QuadrupleToPart"><span class="hs-identifier hs-type">QuadrupleToPart</span></a></span><span>
</span><span id="line-90"></span><span>        </span><span id="local-6989586621679339020"><span class="annot"><span class="annottext">withAnyMove :: Predicate QuadrupleToPart
</span><a href="#local-6989586621679339020"><span class="hs-identifier hs-var hs-var">withAnyMove</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="TuringMachine.SymbolOrMove.html#M"><span class="hs-identifier hs-type">M</span></a></span><span> </span><span class="annot"><span class="annottext">Move
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><a href="#local-6989586621679339020"><span class="hs-identifier hs-var">withAnyMove</span></a></span><span> </span><span class="annot"><span class="annottext">QuadrupleToPart
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><a href="#local-6989586621679339007"><span class="hs-identifier hs-type">stateToFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#Predicate"><span class="hs-identifier hs-type">Predicate</span></a></span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#QuadrupleToPart"><span class="hs-identifier hs-type">QuadrupleToPart</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span id="local-6989586621679339007"><span class="annot"><span class="annottext">stateToFrom :: Set State -&gt; Predicate QuadrupleToPart
</span><a href="#local-6989586621679339007"><span class="hs-identifier hs-var hs-var">stateToFrom</span></a></span></span><span> </span><span id="local-6989586621679338980"><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338980"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MoveOr Symbol
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338979"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338979"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338979"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; Set State -&gt; IsChanged
forall c v. Containable c v =&gt; v -&gt; c -&gt; IsChanged
</span><a href="Containers.html#member"><span class="hs-operator hs-var">`member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338980"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span id="local-6989586621679339127"><span class="annot"><a href="TuringMachine.Optimization.html#unconsSet"><span class="hs-identifier hs-type">unconsSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679339127"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679339127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679339127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-96"></span><span id="unconsSet"><span class="annot"><span class="annottext">unconsSet :: Set a -&gt; (a, Set a)
</span><a href="TuringMachine.Optimization.html#unconsSet"><span class="hs-identifier hs-var hs-var">unconsSet</span></a></span></span><span> </span><span id="local-6989586621679338977"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679338977"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set a -&gt; a
forall a. Set a -&gt; a
</span><span class="hs-identifier hs-var">findMin</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679338977"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set a -&gt; Set a
forall a. Set a -&gt; Set a
</span><span class="hs-identifier hs-var">deleteMin</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679338977"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="TuringMachine.Optimization.html#mergeSimilarStates"><span class="hs-identifier hs-type">mergeSimilarStates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-99"></span><span id="mergeSimilarStates"><span class="annot"><span class="annottext">mergeSimilarStates :: TMConverting
</span><a href="TuringMachine.Optimization.html#mergeSimilarStates"><span class="hs-identifier hs-var hs-var">mergeSimilarStates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>    </span><span id="local-6989586621679338975"><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338975"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
-&gt; StateT TuringMachine (State IsChanged) Quadruples
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621679338974"><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338974"><span class="hs-identifier hs-var">allQs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting (Set State) TuringMachine (Set State)
-&gt; StateT TuringMachine (State IsChanged) (Set State)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting (Set State) TuringMachine (Set State)
TMGetter (Set State)
</span><a href="TuringMachine.html#allStates"><span class="hs-identifier hs-var">allStates</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679338973"><span class="annot"><span class="annottext">Map Symbol (Set State)
</span><a href="#local-6989586621679338973"><span class="hs-identifier hs-var">statesWithSymbols</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-103"></span><span>            </span><span class="annot"><span class="annottext">(Set State -&gt; Set State -&gt; Set State)
-&gt; [(Symbol, Set State)] -&gt; Map Symbol (Set State)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; Set State -&gt; Set State
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%2F"><span class="hs-operator hs-var">(\/)</span></a></span><span> </span><span class="annot"><span class="annottext">([(Symbol, Set State)] -&gt; Map Symbol (Set State))
-&gt; [(Symbol, Set State)] -&gt; Map Symbol (Set State)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set State, Symbol) -&gt; (Symbol, Set State)
forall a b. (a, b) -&gt; (b, a)
</span><span class="hs-identifier hs-var">swap</span></span><span> </span><span class="annot"><span class="annottext">((Set State, Symbol) -&gt; (Symbol, Set State))
-&gt; (QuadrupleFromPart -&gt; (Set State, Symbol))
-&gt; QuadrupleFromPart
-&gt; (Symbol, Set State)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(State -&gt; Identity (Set State))
-&gt; QuadrupleFromPart -&gt; Identity (Set State, Symbol)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">((State -&gt; Identity (Set State))
 -&gt; QuadrupleFromPart -&gt; Identity (Set State, Symbol))
-&gt; (State -&gt; Set State) -&gt; QuadrupleFromPart -&gt; (Set State, Symbol)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; Set State
forall c v. Singletonable c v =&gt; v -&gt; c
</span><a href="Containers.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QuadrupleFromPart -&gt; (Symbol, Set State))
-&gt; [QuadrupleFromPart] -&gt; [(Symbol, Set State)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; [QuadrupleFromPart]
forall c k. Keyable c k =&gt; c -&gt; [k]
</span><a href="Containers.html#keys"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338975"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-104"></span><span>        </span><span id="local-6989586621679338969"><span class="annot"><span class="annottext">statesWithoutSymbols :: Map Symbol (Set State)
</span><a href="#local-6989586621679338969"><span class="hs-identifier hs-var hs-var">statesWithoutSymbols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-105"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338974"><span class="hs-identifier hs-var">allQs</span></a></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; State -&gt; Set State
forall c v. Deletable c v =&gt; c -&gt; v -&gt; c
</span><a href="Containers.html#%3C%5C"><span class="hs-operator hs-var">&lt;\</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="TuringMachine.State.html#finalState"><span class="hs-identifier hs-var">finalState</span></a></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; Set State -&gt; Set State
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%5C"><span class="hs-operator hs-var">\\</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set State -&gt; Set State)
-&gt; Map Symbol (Set State) -&gt; Map Symbol (Set State)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Set State)
</span><a href="#local-6989586621679338973"><span class="hs-identifier hs-var">statesWithSymbols</span></a></span><span>
</span><span id="line-106"></span><span>        </span><span id="local-6989586621679338967"><span class="annot"><span class="annottext">[Set State] -&gt; [Set State]
</span><a href="#local-6989586621679338967"><span class="hs-identifier hs-var">removeUselessGroups</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-107"></span><span>            </span><span class="annot"><span class="annottext">(Set State -&gt; IsChanged) -&gt; [Set State] -&gt; [Set State]
forall a. (a -&gt; IsChanged) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IsChanged
forall a. Ord a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IsChanged) -&gt; (Set State -&gt; Int) -&gt; Set State -&gt; IsChanged
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; Int
forall c. Sizable c =&gt; c -&gt; Int
</span><a href="Containers.html#size"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>        </span><span id="local-6989586621679338966"><span class="annot"><span class="annottext">cloneLoops :: [Quadruple] -&gt; [Quadruple]
</span><a href="#local-6989586621679338966"><span class="hs-identifier hs-var hs-var">cloneLoops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>            </span><span class="annot"><span class="annottext">(Quadruple -&gt; [Quadruple]) -&gt; [Quadruple] -&gt; [Quadruple]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">((Quadruple -&gt; [Quadruple]) -&gt; [Quadruple] -&gt; [Quadruple])
-&gt; (Quadruple -&gt; [Quadruple]) -&gt; [Quadruple] -&gt; [Quadruple]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679338964"><span class="annot"><span class="annottext">quad :: Quadruple
</span><a href="#local-6989586621679338964"><span class="hs-identifier hs-var">quad</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679338963"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338963"><span class="hs-identifier hs-var">qf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338962"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338962"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679338961"><span class="annot"><span class="annottext">MoveOr Symbol
</span><a href="#local-6989586621679338961"><span class="hs-identifier hs-var">sm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338960"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338960"><span class="hs-identifier hs-var">qt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-110"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338963"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; IsChanged
forall a. Eq a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338960"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-111"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Quadruple
</span><a href="#local-6989586621679338964"><span class="hs-identifier hs-var">quad</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338963"><span class="hs-identifier hs-var">qf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338962"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MoveOr Symbol
</span><a href="#local-6989586621679338961"><span class="hs-identifier hs-var">sm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; State
</span><a href="TuringMachine.State.html#state"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Quadruple
</span><a href="#local-6989586621679338964"><span class="hs-identifier hs-var">quad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#Quadruple"><span class="hs-identifier hs-type">TuringMachine.Quadruple</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>        </span><span id="local-6989586621679338958"><span class="annot"><span class="annottext">Map Symbol [(QuadrupleToPart, Set State)]
</span><a href="#local-6989586621679338958"><span class="hs-identifier hs-var">qsGroupedBySymbol</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="TuringMachine.SymbolOrMove.html#SymbolOrMove"><span class="hs-identifier hs-type">SymbolOrMove</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><span class="annottext">([(QuadrupleToPart, Set State)]
 -&gt; [(QuadrupleToPart, Set State)]
 -&gt; [(QuadrupleToPart, Set State)])
-&gt; [(Symbol, [(QuadrupleToPart, Set State)])]
-&gt; Map Symbol [(QuadrupleToPart, Set State)]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">fromListWith</span></span><span> </span><span class="annot"><span class="annottext">[(QuadrupleToPart, Set State)]
-&gt; [(QuadrupleToPart, Set State)] -&gt; [(QuadrupleToPart, Set State)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="annot"><span class="annottext">([(Symbol, [(QuadrupleToPart, Set State)])]
 -&gt; Map Symbol [(QuadrupleToPart, Set State)])
-&gt; [(Symbol, [(QuadrupleToPart, Set State)])]
-&gt; Map Symbol [(QuadrupleToPart, Set State)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-115"></span><span>                </span><span class="annot"><span class="annottext">(Quadruple -&gt; (Symbol, [(QuadrupleToPart, Set State)]))
-&gt; [Quadruple] -&gt; [(Symbol, [(QuadrupleToPart, Set State)])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679338956"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338956"><span class="hs-identifier hs-var">qf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338955"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338955"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338954"><span class="annot"><span class="annottext">QuadrupleToPart
</span><a href="#local-6989586621679338954"><span class="hs-identifier hs-var">sm_qt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338955"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuadrupleToPart
</span><a href="#local-6989586621679338954"><span class="hs-identifier hs-var">sm_qt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State -&gt; Set State
forall c v. Singletonable c v =&gt; v -&gt; c
</span><a href="Containers.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338956"><span class="hs-identifier hs-var">qf</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Quadruple] -&gt; [(Symbol, [(QuadrupleToPart, Set State)])])
-&gt; [Quadruple] -&gt; [(Symbol, [(QuadrupleToPart, Set State)])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-116"></span><span>                    </span><span class="annot"><span class="annottext">[Quadruple] -&gt; [Quadruple]
</span><a href="#local-6989586621679338966"><span class="hs-identifier hs-var">cloneLoops</span></a></span><span> </span><span class="annot"><span class="annottext">([Quadruple] -&gt; [Quadruple]) -&gt; [Quadruple] -&gt; [Quadruple]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-117"></span><span>                        </span><span class="annot"><span class="annottext">Quadruples -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338975"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span id="local-6989586621679338952"><span class="annot"><span class="annottext">qsGroupedBySymbolAndQuadrupleSndPart :: Map Symbol (Map QuadrupleToPart (Set State))
</span><a href="#local-6989586621679338952"><span class="hs-identifier hs-var hs-var">qsGroupedBySymbolAndQuadrupleSndPart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>            </span><span class="annot"><span class="annottext">(Set State -&gt; Set State -&gt; Set State)
-&gt; [(QuadrupleToPart, Set State)]
-&gt; Map QuadrupleToPart (Set State)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">fromListWith</span></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; Set State -&gt; Set State
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%2F"><span class="hs-operator hs-var">(\/)</span></a></span><span> </span><span class="annot"><span class="annottext">([(QuadrupleToPart, Set State)] -&gt; Map QuadrupleToPart (Set State))
-&gt; Map Symbol [(QuadrupleToPart, Set State)]
-&gt; Map Symbol (Map QuadrupleToPart (Set State))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol [(QuadrupleToPart, Set State)]
</span><a href="#local-6989586621679338958"><span class="hs-identifier hs-var">qsGroupedBySymbol</span></a></span><span>
</span><span id="line-120"></span><span>        </span><span id="local-6989586621679338951"><span class="annot"><span class="annottext">[[Set State]]
</span><a href="#local-6989586621679338951"><span class="hs-identifier hs-var">groupsOfStates</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><span class="annottext">Map Symbol [Set State] -&gt; [[Set State]]
forall c v. Valuable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#values"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Symbol [Set State] -&gt; [[Set State]])
-&gt; Map Symbol [Set State] -&gt; [[Set State]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-122"></span><span>                </span><span class="annot"><span class="annottext">(Symbol -&gt; Map QuadrupleToPart (Set State) -&gt; [Set State])
-&gt; Map Symbol (Map QuadrupleToPart (Set State))
-&gt; Map Symbol [Set State]
forall k a b. (k -&gt; a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">mapWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679338950"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338950"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-123"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679338949"><span class="annot"><span class="annottext">qsWithoutS :: Set State
</span><a href="#local-6989586621679338949"><span class="hs-identifier hs-var hs-var">qsWithoutS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>                            </span><span class="annot"><span class="annottext">Set State -&gt; Maybe (Set State) -&gt; Set State
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Set State
forall c. Nullable c =&gt; c
</span><a href="Containers.html#emptyC"><span class="hs-identifier hs-var">emptyC</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set State) -&gt; Set State) -&gt; Maybe (Set State) -&gt; Set State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Set State)
</span><a href="#local-6989586621679338969"><span class="hs-identifier hs-var">statesWithoutSymbols</span></a></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Set State) -&gt; Symbol -&gt; Maybe (Set State)
forall c k v (m :: * -&gt; *).
(Indexable c k v, MonadFail m) =&gt;
c -&gt; k -&gt; m v
</span><a href="Containers.html#%21%3F"><span class="hs-operator hs-var">!?</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338950"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-125"></span><span>                    </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">[Set State] -&gt; [Set State]
</span><a href="#local-6989586621679338967"><span class="hs-identifier hs-var">removeUselessGroups</span></a></span><span> </span><span class="annot"><span class="annottext">([Set State] -&gt; [Set State])
-&gt; (Map QuadrupleToPart (Set State) -&gt; [Set State])
-&gt; Map QuadrupleToPart (Set State)
-&gt; [Set State]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-126"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338949"><span class="hs-identifier hs-var">qsWithoutS</span></a></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; [Set State] -&gt; [Set State]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Set State] -&gt; [Set State])
-&gt; (Map QuadrupleToPart (Set State) -&gt; [Set State])
-&gt; Map QuadrupleToPart (Set State)
-&gt; [Set State]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-127"></span><span>                        </span><span class="annot"><span class="annottext">(Set State -&gt; Set State) -&gt; [Set State] -&gt; [Set State]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set State -&gt; Set State -&gt; Set State
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%2F"><span class="hs-operator hs-var">\/</span></a></span><span> </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338949"><span class="hs-identifier hs-var">qsWithoutS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Set State] -&gt; [Set State])
-&gt; (Map QuadrupleToPart (Set State) -&gt; [Set State])
-&gt; Map QuadrupleToPart (Set State)
-&gt; [Set State]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-128"></span><span>                        </span><span class="annot"><span class="annottext">Map QuadrupleToPart (Set State) -&gt; [Set State]
forall c v. Valuable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#values"><span class="hs-identifier hs-var">values</span></a></span><span>
</span><span id="line-129"></span><span>                  </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map Symbol (Map QuadrupleToPart (Set State))
 -&gt; Map Symbol [Set State])
-&gt; Map Symbol (Map QuadrupleToPart (Set State))
-&gt; Map Symbol [Set State]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-130"></span><span>                    </span><span class="annot"><span class="annottext">Map Symbol (Map QuadrupleToPart (Set State))
</span><a href="#local-6989586621679338952"><span class="hs-identifier hs-var">qsGroupedBySymbolAndQuadrupleSndPart</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span id="local-6989586621679338947"><span class="annot"><span class="annottext">merge2ListsOfGroups :: [Set State] -&gt; [Set State] -&gt; [Set State]
</span><a href="#local-6989586621679338947"><span class="hs-identifier hs-var hs-var">merge2ListsOfGroups</span></a></span></span><span> </span><span id="local-6989586621679338946"><span class="annot"><span class="annottext">[Set State]
</span><a href="#local-6989586621679338946"><span class="hs-identifier hs-var">log1</span></a></span></span><span> </span><span id="local-6989586621679338945"><span class="annot"><span class="annottext">[Set State]
</span><a href="#local-6989586621679338945"><span class="hs-identifier hs-var">log2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set State] -&gt; [Set State]
</span><a href="#local-6989586621679338967"><span class="hs-identifier hs-var">removeUselessGroups</span></a></span><span> </span><span class="annot"><span class="annottext">([Set State] -&gt; [Set State]) -&gt; [Set State] -&gt; [Set State]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Set State] -&gt; [Set State]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nubOrd</span></span><span> </span><span class="annot"><span class="annottext">([Set State] -&gt; [Set State]) -&gt; [Set State] -&gt; [Set State]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>            </span><span id="local-6989586621679338944"><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338944"><span class="hs-identifier hs-var">g1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Set State]
</span><a href="#local-6989586621679338946"><span class="hs-identifier hs-var">log1</span></a></span><span>
</span><span id="line-133"></span><span>            </span><span id="local-6989586621679338943"><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338943"><span class="hs-identifier hs-var">g2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Set State]
</span><a href="#local-6989586621679338945"><span class="hs-identifier hs-var">log2</span></a></span><span>
</span><span id="line-134"></span><span>            </span><span class="annot"><span class="annottext">Set State -&gt; [Set State]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Set State -&gt; [Set State]) -&gt; Set State -&gt; [Set State]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338944"><span class="hs-identifier hs-var">g1</span></a></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; Set State -&gt; Set State
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a></span><span> </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338943"><span class="hs-identifier hs-var">g2</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span id="local-6989586621679338941"><span class="annot"><span class="annottext">totalListOfGroups :: [Set State]
</span><a href="#local-6989586621679338941"><span class="hs-identifier hs-var hs-var">totalListOfGroups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Set State] -&gt; [Set State] -&gt; [Set State])
-&gt; [[Set State]] -&gt; [Set State]
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldl1</span></span><span> </span><span class="annot"><span class="annottext">[Set State] -&gt; [Set State] -&gt; [Set State]
</span><a href="#local-6989586621679338947"><span class="hs-identifier hs-var">merge2ListsOfGroups</span></a></span><span> </span><span class="annot"><span class="annottext">[[Set State]]
</span><a href="#local-6989586621679338951"><span class="hs-identifier hs-var">groupsOfStates</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">IsChanged -&gt; TMConverting -&gt; TMConverting
forall (f :: * -&gt; *). Applicative f =&gt; IsChanged -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged -&gt; IsChanged
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(IsChanged -&gt; IsChanged) -&gt; IsChanged -&gt; IsChanged
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Set State] -&gt; IsChanged
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; IsChanged
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Set State]
</span><a href="#local-6989586621679338941"><span class="hs-identifier hs-var">totalListOfGroups</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; TMConverting) -&gt; TMConverting -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679338937"><span class="annot"><span class="annottext">Map State State
</span><a href="#local-6989586621679338937"><span class="hs-identifier hs-var">statesWithSimilarState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>                </span><span class="annot"><span class="annottext">[(State, State)] -&gt; Map State State
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(State, State)] -&gt; Map State State)
-&gt; [(State, State)] -&gt; Map State State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-139"></span><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679338936"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338936"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338935"><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338935"><span class="hs-identifier hs-var">qs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338936"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(State -&gt; (State, State)) -&gt; [State] -&gt; [(State, State)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; [State]
forall c v. Valuable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#values"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338935"><span class="hs-identifier hs-var">qs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((State, Set State) -&gt; [(State, State)])
-&gt; (State, Set State) -&gt; [(State, State)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-140"></span><span>                        </span><span class="annot"><span class="annottext">Set State -&gt; (State, Set State)
forall a. Set a -&gt; (a, Set a)
</span><a href="TuringMachine.Optimization.html#unconsSet"><span class="hs-identifier hs-var">unconsSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Set State -&gt; (State, Set State))
-&gt; Set State -&gt; (State, Set State)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-141"></span><span>                            </span><span class="annot"><span class="annottext">(Set State -&gt; Set State -&gt; Ordering) -&gt; [Set State] -&gt; Set State
forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximumBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Ordering)
-&gt; (Set State -&gt; Int) -&gt; Set State -&gt; Set State -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; Int
forall c. Sizable c =&gt; c -&gt; Int
</span><a href="Containers.html#size"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Set State] -&gt; Set State) -&gt; [Set State] -&gt; Set State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-142"></span><span>                                </span><span class="annot"><span class="annottext">[Set State]
</span><a href="#local-6989586621679338941"><span class="hs-identifier hs-var">totalListOfGroups</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">(State -&gt; Identity (Maybe State))
-&gt; TuringMachine -&gt; Identity TuringMachine
TMSetter State (Maybe State)
</span><a href="TuringMachine.html#states"><span class="hs-identifier hs-var">states</span></a></span><span> </span><span class="annot"><span class="annottext">((State -&gt; Identity (Maybe State))
 -&gt; TuringMachine -&gt; Identity TuringMachine)
-&gt; (State -&gt; Maybe State) -&gt; TMConverting
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><span class="hs-operator hs-var">%=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679338930"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338930"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">State -&gt; Maybe State
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(State -&gt; Maybe State) -&gt; State -&gt; Maybe State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; Maybe State -&gt; State
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338930"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe State -&gt; State) -&gt; Maybe State -&gt; State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map State State
</span><a href="#local-6989586621679338937"><span class="hs-identifier hs-var">statesWithSimilarState</span></a></span><span> </span><span class="annot"><span class="annottext">Map State State -&gt; State -&gt; Maybe State
forall c k v (m :: * -&gt; *).
(Indexable c k v, MonadFail m) =&gt;
c -&gt; k -&gt; m v
</span><a href="Containers.html#%21%3F"><span class="hs-operator hs-var">!?</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679338930"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#isChanged"><span class="hs-identifier hs-var">isChanged</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="TuringMachine.Optimization.html#removeUnknownSymbols"><span class="hs-identifier hs-type">removeUnknownSymbols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-147"></span><span id="removeUnknownSymbols"><span class="annot"><span class="annottext">removeUnknownSymbols :: TMConverting
</span><a href="TuringMachine.Optimization.html#removeUnknownSymbols"><span class="hs-identifier hs-var hs-var">removeUnknownSymbols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679338928"><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338928"><span class="hs-identifier hs-var">symbolsFromAlphabet</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike' (Const (Set Symbol)) TuringMachine Alphabet
-&gt; (Alphabet -&gt; Set Symbol)
-&gt; StateT TuringMachine (State IsChanged) (Set Symbol)
forall s (m :: * -&gt; *) r a.
MonadState s m =&gt;
LensLike' (Const r) s a -&gt; (a -&gt; r) -&gt; m r
</span><span class="hs-identifier hs-var">uses</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Const (Set Symbol)) TuringMachine Alphabet
Lens' TuringMachine Alphabet
</span><a href="TuringMachine.html#alphabet"><span class="hs-identifier hs-var">alphabet</span></a></span><span> </span><span class="annot"><span class="annottext">Alphabet -&gt; Set Symbol
forall c v. (Valuable c v, Ord v) =&gt; c -&gt; Set v
</span><a href="Containers.html#valuesSet"><span class="hs-identifier hs-var">valuesSet</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621679338925"><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338925"><span class="hs-identifier hs-var">symbolsFromAllPlaces</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting (Set Symbol) TuringMachine (Set Symbol)
-&gt; StateT TuringMachine (State IsChanged) (Set Symbol)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span>  </span><span class="annot"><span class="annottext">Getting (Set Symbol) TuringMachine (Set Symbol)
TMGetter (Set Symbol)
</span><a href="TuringMachine.html#allSymbols"><span class="hs-identifier hs-var">allSymbols</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">IsChanged -&gt; TMConverting -&gt; TMConverting
forall (f :: * -&gt; *). Applicative f =&gt; IsChanged -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged -&gt; IsChanged
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(IsChanged -&gt; IsChanged) -&gt; IsChanged -&gt; IsChanged
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; IsChanged
forall c. Nullable c =&gt; c -&gt; IsChanged
</span><a href="Containers.html#nullC"><span class="hs-identifier hs-var">nullC</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Symbol -&gt; IsChanged) -&gt; Set Symbol -&gt; IsChanged
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338925"><span class="hs-identifier hs-var">symbolsFromAllPlaces</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; Set Symbol -&gt; Set Symbol
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%5C"><span class="hs-operator hs-var">\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338928"><span class="hs-identifier hs-var">symbolsFromAlphabet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; TMConverting) -&gt; TMConverting -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><span class="annottext">(Symbol -&gt; Identity (Maybe Symbol))
-&gt; TuringMachine -&gt; Identity TuringMachine
TMSetter Symbol (Maybe Symbol)
</span><a href="TuringMachine.html#symbols"><span class="hs-identifier hs-var">symbols</span></a></span><span> </span><span class="annot"><span class="annottext">((Symbol -&gt; Identity (Maybe Symbol))
 -&gt; TuringMachine -&gt; Identity TuringMachine)
-&gt; (Symbol -&gt; Maybe Symbol) -&gt; TMConverting
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><span class="hs-operator hs-var">%=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679338921"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338921"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338921"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Set Symbol -&gt; IsChanged
forall c v. Containable c v =&gt; v -&gt; c -&gt; IsChanged
</span><a href="Containers.html#member"><span class="hs-operator hs-var">`member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338928"><span class="hs-identifier hs-var">symbolsFromAlphabet</span></a></span><span>
</span><span id="line-153"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Maybe Symbol
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679338921"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-154"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#isChanged"><span class="hs-identifier hs-var">isChanged</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="TuringMachine.Optimization.html#removeUnusedStates"><span class="hs-identifier hs-type">removeUnusedStates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-158"></span><span id="removeUnusedStates"><span class="annot"><span class="annottext">removeUnusedStates :: TMConverting
</span><a href="TuringMachine.Optimization.html#removeUnusedStates"><span class="hs-identifier hs-var hs-var">removeUnusedStates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621679338919"><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338919"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
-&gt; StateT TuringMachine (State IsChanged) Quadruples
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679338918"><span class="annot"><span class="annottext">takeStates :: ((a, b), (a, a)) -&gt; [a]
</span><a href="#local-6989586621679338918"><span class="hs-identifier hs-var hs-var">takeStates</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679338917"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338917"><span class="hs-identifier hs-var">q1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338916"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338916"><span class="hs-identifier hs-var">q2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338917"><span class="hs-identifier hs-var">q1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338916"><span class="hs-identifier hs-var">q2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span>        </span><span id="local-6989586621679338915"><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338915"><span class="hs-identifier hs-var">statesFromQs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[State] -&gt; Set State
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([State] -&gt; Set State) -&gt; [State] -&gt; Set State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[State]] -&gt; [State]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[State]] -&gt; [State]) -&gt; [[State]] -&gt; [State]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Quadruple -&gt; [State]
forall a b a. ((a, b), (a, a)) -&gt; [a]
</span><a href="#local-6989586621679338918"><span class="hs-identifier hs-var">takeStates</span></a></span><span> </span><span class="annot"><span class="annottext">(Quadruple -&gt; [State]) -&gt; [Quadruple] -&gt; [[State]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338919"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set State -&gt; State -&gt; Set State
forall c v. Insertable c v =&gt; c -&gt; v -&gt; c
</span><a href="Containers.html#%3C%2B"><span class="hs-operator hs-var">&lt;+</span></a></span><span>
</span><span id="line-163"></span><span>                </span><span class="annot"><span class="annottext">State
</span><a href="TuringMachine.State.html#startState"><span class="hs-identifier hs-var">startState</span></a></span><span> </span><span class="annot"><span class="annottext">Set State -&gt; State -&gt; Set State
forall c v. Insertable c v =&gt; c -&gt; v -&gt; c
</span><a href="Containers.html#%3C%2B"><span class="hs-operator hs-var">&lt;+</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="TuringMachine.State.html#finalState"><span class="hs-identifier hs-var">finalState</span></a></span><span>
</span><span id="line-164"></span><span>        </span><span id="local-6989586621679338912"><span class="annot"><span class="annottext">Map State State
</span><a href="#local-6989586621679338912"><span class="hs-identifier hs-var">renumberedStates</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="TuringMachine.State.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>            </span><span class="annot"><span class="annottext">[(State, State)] -&gt; Map State State
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(State, State)] -&gt; Map State State)
-&gt; [(State, State)] -&gt; Map State State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[State] -&gt; [State] -&gt; [(State, State)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set State -&gt; [State]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set State
</span><a href="#local-6989586621679338915"><span class="hs-identifier hs-var">statesFromQs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">State
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><span class="annottext">(State -&gt; Identity (Maybe State))
-&gt; TuringMachine -&gt; Identity TuringMachine
TMSetter State (Maybe State)
</span><a href="TuringMachine.html#states"><span class="hs-identifier hs-var">states</span></a></span><span> </span><span class="annot"><span class="annottext">((State -&gt; Identity (Maybe State))
 -&gt; TuringMachine -&gt; Identity TuringMachine)
-&gt; (State -&gt; Maybe State) -&gt; TMConverting
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><span class="hs-operator hs-var">%=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map State State
</span><a href="#local-6989586621679338912"><span class="hs-identifier hs-var">renumberedStates</span></a></span><span> </span><span class="annot"><span class="annottext">Map State State -&gt; State -&gt; Maybe State
forall c k v (m :: * -&gt; *).
(Indexable c k v, MonadFail m) =&gt;
c -&gt; k -&gt; m v
</span><a href="Containers.html#%21%3F"><span class="hs-operator hs-var">!?</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><a href="TuringMachine.Optimization.html#removeUnusedSymbols"><span class="hs-identifier hs-type">removeUnusedSymbols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-169"></span><span id="removeUnusedSymbols"><span class="annot"><span class="annottext">removeUnusedSymbols :: TMConverting
</span><a href="TuringMachine.Optimization.html#removeUnusedSymbols"><span class="hs-identifier hs-var hs-var">removeUnusedSymbols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621679338909"><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338909"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
-&gt; StateT TuringMachine (State IsChanged) Quadruples
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679338908"><span class="annot"><span class="annottext">takeSymbols :: ((a, a), (MoveOr a, b)) -&gt; [a]
</span><a href="#local-6989586621679338908"><span class="hs-identifier hs-var hs-var">takeSymbols</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338907"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338907"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679338906"><span class="annot"><span class="annottext">MoveOr a
</span><a href="#local-6989586621679338906"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MoveOr a
</span><a href="#local-6989586621679338906"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-173"></span><span>                </span><span class="annot"><a href="TuringMachine.SymbolOrMove.html#M"><span class="hs-identifier hs-type">M</span></a></span><span> </span><span class="annot"><span class="annottext">Move
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338907"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>                </span><span class="annot"><a href="TuringMachine.SymbolOrMove.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679338905"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338905"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338907"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679338905"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621679338904"><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338904"><span class="hs-identifier hs-var">symbolsFromQs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="annottext">[Symbol] -&gt; Set Symbol
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol] -&gt; Set Symbol) -&gt; [Symbol] -&gt; Set Symbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Symbol]] -&gt; [Symbol]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Symbol]] -&gt; [Symbol]) -&gt; [[Symbol]] -&gt; [Symbol]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Quadruple -&gt; [Symbol]
forall a a b. ((a, a), (MoveOr a, b)) -&gt; [a]
</span><a href="#local-6989586621679338908"><span class="hs-identifier hs-var">takeSymbols</span></a></span><span> </span><span class="annot"><span class="annottext">(Quadruple -&gt; [Symbol]) -&gt; [Quadruple] -&gt; [[Symbol]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338909"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-177"></span><span>        </span><span id="local-6989586621679338903"><span class="annot"><span class="annottext">Map Symbol Symbol
</span><a href="#local-6989586621679338903"><span class="hs-identifier hs-var">renumberedSymbols</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="TuringMachine.Symbol.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><span class="annottext">[(Symbol, Symbol)] -&gt; Map Symbol Symbol
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Symbol, Symbol)] -&gt; Map Symbol Symbol)
-&gt; [(Symbol, Symbol)] -&gt; Map Symbol Symbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Symbol] -&gt; [Symbol] -&gt; [(Symbol, Symbol)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Symbol -&gt; [Symbol]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679338904"><span class="hs-identifier hs-var">symbolsFromQs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">(Symbol -&gt; Identity (Maybe Symbol))
-&gt; TuringMachine -&gt; Identity TuringMachine
TMSetter Symbol (Maybe Symbol)
</span><a href="TuringMachine.html#symbols"><span class="hs-identifier hs-var">symbols</span></a></span><span> </span><span class="annot"><span class="annottext">((Symbol -&gt; Identity (Maybe Symbol))
 -&gt; TuringMachine -&gt; Identity TuringMachine)
-&gt; (Symbol -&gt; Maybe Symbol) -&gt; TMConverting
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><span class="hs-operator hs-var">%=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Symbol Symbol
</span><a href="#local-6989586621679338903"><span class="hs-identifier hs-var">renumberedSymbols</span></a></span><span> </span><span class="annot"><span class="annottext">Map Symbol Symbol -&gt; Symbol -&gt; Maybe Symbol
forall c k v (m :: * -&gt; *).
(Indexable c k v, MonadFail m) =&gt;
c -&gt; k -&gt; m v
</span><a href="Containers.html#%21%3F"><span class="hs-operator hs-var">!?</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><a href="TuringMachine.Optimization.html#fixIfQuadrupleFromFinalState"><span class="hs-identifier hs-type">fixIfQuadrupleFromFinalState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-182"></span><span id="fixIfQuadrupleFromFinalState"><span class="annot"><span class="annottext">fixIfQuadrupleFromFinalState :: TMConverting
</span><a href="TuringMachine.Optimization.html#fixIfQuadrupleFromFinalState"><span class="hs-identifier hs-var hs-var">fixIfQuadrupleFromFinalState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679338901"><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338901"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
-&gt; StateT TuringMachine (State IsChanged) Quadruples
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679338900"><span class="annot"><span class="annottext">fromFinalState :: Predicate Quadruple
</span><a href="#local-6989586621679338900"><span class="hs-identifier hs-var hs-var">fromFinalState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensLike' (Const IsChanged) Quadruple State
-&gt; (State -&gt; IsChanged) -&gt; Predicate Quadruple
forall s (m :: * -&gt; *) r a.
MonadReader s m =&gt;
LensLike' (Const r) s a -&gt; (a -&gt; r) -&gt; m r
</span><span class="hs-identifier hs-var">views</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QuadrupleFromPart -&gt; Const IsChanged QuadrupleFromPart)
-&gt; Quadruple -&gt; Const IsChanged Quadruple
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="annot"><span class="annottext">((QuadrupleFromPart -&gt; Const IsChanged QuadrupleFromPart)
 -&gt; Quadruple -&gt; Const IsChanged Quadruple)
-&gt; ((State -&gt; Const IsChanged State)
    -&gt; QuadrupleFromPart -&gt; Const IsChanged QuadrupleFromPart)
-&gt; LensLike' (Const IsChanged) Quadruple State
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(State -&gt; Const IsChanged State)
-&gt; QuadrupleFromPart -&gt; Const IsChanged QuadrupleFromPart
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State -&gt; State -&gt; IsChanged
forall a. Eq a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="TuringMachine.State.html#finalState"><span class="hs-identifier hs-var">finalState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><span class="annottext">IsChanged -&gt; TMConverting -&gt; TMConverting
forall (f :: * -&gt; *). Applicative f =&gt; IsChanged -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[IsChanged] -&gt; IsChanged
forall (t :: * -&gt; *). Foldable t =&gt; t IsChanged -&gt; IsChanged
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="annot"><span class="annottext">([IsChanged] -&gt; IsChanged) -&gt; [IsChanged] -&gt; IsChanged
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Predicate Quadruple
</span><a href="#local-6989586621679338900"><span class="hs-identifier hs-var">fromFinalState</span></a></span><span> </span><span class="annot"><span class="annottext">Predicate Quadruple -&gt; [Quadruple] -&gt; [IsChanged]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338901"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; TMConverting) -&gt; TMConverting -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>        </span><span id="local-6989586621679338897"><span class="annot"><span class="annottext">[ShowedSymbol]
</span><a href="#local-6989586621679338897"><span class="hs-identifier hs-var">allSs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="TuringMachine.ShowedSymbol.html#ShowedSymbol"><span class="hs-identifier hs-type">ShowedSymbol</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike' (Const [ShowedSymbol]) TuringMachine Alphabet
-&gt; (Alphabet -&gt; [ShowedSymbol])
-&gt; StateT TuringMachine (State IsChanged) [ShowedSymbol]
forall s (m :: * -&gt; *) r a.
MonadState s m =&gt;
LensLike' (Const r) s a -&gt; (a -&gt; r) -&gt; m r
</span><span class="hs-identifier hs-var">uses</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Const [ShowedSymbol]) TuringMachine Alphabet
Lens' TuringMachine Alphabet
</span><a href="TuringMachine.html#alphabet"><span class="hs-identifier hs-var">alphabet</span></a></span><span> </span><span class="annot"><span class="annottext">Alphabet -&gt; [ShowedSymbol]
forall c v. Valuable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#values"><span class="hs-identifier hs-var">values</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><span class="annottext">TuringMachine -&gt; TMConverting
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(TuringMachine -&gt; TMConverting) -&gt; TuringMachine -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ShowedSymbol] -&gt; TuringMachine
forall s. ShowedSymbolClass s =&gt; [s] -&gt; TuringMachine
</span><a href="TuringMachine.Constructors.html#die"><span class="hs-identifier hs-var">die</span></a></span><span> </span><span class="annot"><span class="annottext">[ShowedSymbol]
</span><a href="#local-6989586621679338897"><span class="hs-identifier hs-var">allSs</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="TuringMachine.Optimization.html#fixIfWithoutFinalState"><span class="hs-identifier hs-type">fixIfWithoutFinalState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-190"></span><span id="fixIfWithoutFinalState"><span class="annot"><span class="annottext">fixIfWithoutFinalState :: TMConverting
</span><a href="TuringMachine.Optimization.html#fixIfWithoutFinalState"><span class="hs-identifier hs-var hs-var">fixIfWithoutFinalState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621679338894"><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338894"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
-&gt; StateT TuringMachine (State IsChanged) Quadruples
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679338893"><span class="annot"><span class="annottext">hasFinalState :: Predicate Quadruple
</span><a href="#local-6989586621679338893"><span class="hs-identifier hs-var hs-var">hasFinalState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensLike' (Const IsChanged) Quadruple State
-&gt; (State -&gt; IsChanged) -&gt; Predicate Quadruple
forall s (m :: * -&gt; *) r a.
MonadReader s m =&gt;
LensLike' (Const r) s a -&gt; (a -&gt; r) -&gt; m r
</span><span class="hs-identifier hs-var">views</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QuadrupleToPart -&gt; Const IsChanged QuadrupleToPart)
-&gt; Quadruple -&gt; Const IsChanged Quadruple
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="annot"><span class="annottext">((QuadrupleToPart -&gt; Const IsChanged QuadrupleToPart)
 -&gt; Quadruple -&gt; Const IsChanged Quadruple)
-&gt; ((State -&gt; Const IsChanged State)
    -&gt; QuadrupleToPart -&gt; Const IsChanged QuadrupleToPart)
-&gt; LensLike' (Const IsChanged) Quadruple State
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(State -&gt; Const IsChanged State)
-&gt; QuadrupleToPart -&gt; Const IsChanged QuadrupleToPart
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State -&gt; State -&gt; IsChanged
forall a. Eq a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="TuringMachine.State.html#finalState"><span class="hs-identifier hs-var">finalState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">IsChanged -&gt; TMConverting -&gt; TMConverting
forall (f :: * -&gt; *). Applicative f =&gt; IsChanged -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[IsChanged] -&gt; IsChanged
forall (t :: * -&gt; *). Foldable t =&gt; t IsChanged -&gt; IsChanged
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="annot"><span class="annottext">([IsChanged] -&gt; IsChanged) -&gt; [IsChanged] -&gt; IsChanged
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IsChanged -&gt; IsChanged
</span><span class="hs-identifier hs-var">not</span></span><span class="annot"><span class="annottext">(IsChanged -&gt; IsChanged)
-&gt; Predicate Quadruple -&gt; Predicate Quadruple
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Predicate Quadruple
</span><a href="#local-6989586621679338893"><span class="hs-identifier hs-var">hasFinalState</span></a></span><span> </span><span class="annot"><span class="annottext">Predicate Quadruple -&gt; [Quadruple] -&gt; [IsChanged]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Quadruples
</span><a href="#local-6989586621679338894"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; TMConverting) -&gt; TMConverting -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>        </span><span id="local-6989586621679338891"><span class="annot"><span class="annottext">[ShowedSymbol]
</span><a href="#local-6989586621679338891"><span class="hs-identifier hs-var">allSs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="TuringMachine.ShowedSymbol.html#ShowedSymbol"><span class="hs-identifier hs-type">ShowedSymbol</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike' (Const [ShowedSymbol]) TuringMachine Alphabet
-&gt; (Alphabet -&gt; [ShowedSymbol])
-&gt; StateT TuringMachine (State IsChanged) [ShowedSymbol]
forall s (m :: * -&gt; *) r a.
MonadState s m =&gt;
LensLike' (Const r) s a -&gt; (a -&gt; r) -&gt; m r
</span><span class="hs-identifier hs-var">uses</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Const [ShowedSymbol]) TuringMachine Alphabet
Lens' TuringMachine Alphabet
</span><a href="TuringMachine.html#alphabet"><span class="hs-identifier hs-var">alphabet</span></a></span><span> </span><span class="annot"><span class="annottext">Alphabet -&gt; [ShowedSymbol]
forall c v. Valuable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#values"><span class="hs-identifier hs-var">values</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">TuringMachine -&gt; TMConverting
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">(TuringMachine -&gt; TMConverting) -&gt; TuringMachine -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ShowedSymbol] -&gt; TuringMachine
forall s. ShowedSymbolClass s =&gt; [s] -&gt; TuringMachine
</span><a href="TuringMachine.Constructors.html#die"><span class="hs-identifier hs-var">die</span></a></span><span> </span><span class="annot"><span class="annottext">[ShowedSymbol]
</span><a href="#local-6989586621679338891"><span class="hs-identifier hs-var">allSs</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="TuringMachine.Optimization.html#optimization"><span class="hs-identifier hs-type">optimization</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#TMConverting"><span class="hs-identifier hs-type">TMConverting</span></a></span><span>
</span><span id="line-198"></span><span id="optimization"><span class="annot"><span class="annottext">optimization :: Level -&gt; TMConverting
</span><a href="TuringMachine.Optimization.html#optimization"><span class="hs-identifier hs-var hs-var">optimization</span></a></span></span><span> </span><span id="local-6989586621679338889"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338889"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">IsChanged -&gt; TMConverting -&gt; TMConverting
forall (f :: * -&gt; *). Applicative f =&gt; IsChanged -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338889"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Level -&gt; Level -&gt; IsChanged
forall a. Ord a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="TuringMachine.Optimization.Level.html#O1"><span class="hs-identifier hs-var">O1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; TMConverting) -&gt; TMConverting -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">TMConverting -&gt; TMConverting
</span><a href="TuringMachine.Optimization.html#infinityConverting"><span class="hs-identifier hs-var">infinityConverting</span></a></span><span> </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#removeUselessQuadruples"><span class="hs-identifier hs-var">removeUselessQuadruples</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">IsChanged -&gt; TMConverting -&gt; TMConverting
forall (f :: * -&gt; *). Applicative f =&gt; IsChanged -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338889"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Level -&gt; Level -&gt; IsChanged
forall a. Ord a =&gt; a -&gt; a -&gt; IsChanged
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="TuringMachine.Optimization.Level.html#O2"><span class="hs-identifier hs-var">O2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; TMConverting) -&gt; TMConverting -&gt; TMConverting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">TMConverting -&gt; TMConverting
</span><a href="TuringMachine.Optimization.html#infinityConverting"><span class="hs-identifier hs-var">infinityConverting</span></a></span><span> </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#mergeSimilarStates"><span class="hs-identifier hs-var">mergeSimilarStates</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#removeUnknownSymbols"><span class="hs-identifier hs-var">removeUnknownSymbols</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#removeUnusedStates"><span class="hs-identifier hs-var">removeUnusedStates</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#removeUnusedSymbols"><span class="hs-identifier hs-var">removeUnusedSymbols</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#fixIfWithoutFinalState"><span class="hs-identifier hs-var">fixIfWithoutFinalState</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">TMConverting
</span><a href="TuringMachine.Optimization.html#fixIfQuadrupleFromFinalState"><span class="hs-identifier hs-var">fixIfQuadrupleFromFinalState</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="annot"><a href="TuringMachine.Optimization.html#optimize%27"><span class="hs-identifier hs-type">optimize'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span id="optimize%27"><span class="annot"><span class="annottext">optimize' :: Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged)
</span><a href="TuringMachine.Optimization.html#optimize%27"><span class="hs-identifier hs-var hs-var">optimize'</span></a></span></span><span> </span><span id="local-6989586621679338885"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338885"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679338884"><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338884"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State IsChanged TuringMachine
 -&gt; IsChanged -&gt; (TuringMachine, IsChanged))
-&gt; IsChanged
-&gt; State IsChanged TuringMachine
-&gt; (TuringMachine, IsChanged)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">State IsChanged TuringMachine
-&gt; IsChanged -&gt; (TuringMachine, IsChanged)
forall s a. State s a -&gt; s -&gt; (a, s)
</span><span class="hs-identifier hs-var">runState</span></span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(State IsChanged TuringMachine -&gt; (TuringMachine, IsChanged))
-&gt; State IsChanged TuringMachine -&gt; (TuringMachine, IsChanged)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; TuringMachine -&gt; State IsChanged TuringMachine)
-&gt; TuringMachine -&gt; TMConverting -&gt; State IsChanged TuringMachine
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">TMConverting -&gt; TuringMachine -&gt; State IsChanged TuringMachine
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">execStateT</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338884"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">(TMConverting -&gt; State IsChanged TuringMachine)
-&gt; TMConverting -&gt; State IsChanged TuringMachine
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Level -&gt; TMConverting
</span><a href="TuringMachine.Optimization.html#optimization"><span class="hs-identifier hs-var">optimization</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338885"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="annot"><a href="TuringMachine.Optimization.html#optimize"><span class="hs-identifier hs-type">optimize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span>
</span><span id="line-213"></span><span id="optimize"><span class="annot"><span class="annottext">optimize :: Level -&gt; TuringMachine -&gt; TuringMachine
</span><a href="TuringMachine.Optimization.html#optimize"><span class="hs-identifier hs-var hs-var">optimize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TuringMachine -&gt; (TuringMachine, IsChanged))
 -&gt; TuringMachine -&gt; TuringMachine)
-&gt; (Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged))
-&gt; Level
-&gt; TuringMachine
-&gt; TuringMachine
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="annot"><span class="annottext">(((TuringMachine -&gt; (TuringMachine, IsChanged))
  -&gt; TuringMachine -&gt; TuringMachine)
 -&gt; (Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged))
 -&gt; Level
 -&gt; TuringMachine
 -&gt; TuringMachine)
-&gt; (((TuringMachine, IsChanged) -&gt; TuringMachine)
    -&gt; (TuringMachine -&gt; (TuringMachine, IsChanged))
    -&gt; TuringMachine
    -&gt; TuringMachine)
-&gt; ((TuringMachine, IsChanged) -&gt; TuringMachine)
-&gt; (Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged))
-&gt; Level
-&gt; TuringMachine
-&gt; TuringMachine
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">((TuringMachine, IsChanged) -&gt; TuringMachine)
-&gt; (TuringMachine -&gt; (TuringMachine, IsChanged))
-&gt; TuringMachine
-&gt; TuringMachine
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TuringMachine, IsChanged) -&gt; TuringMachine
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged)
</span><a href="TuringMachine.Optimization.html#optimize%27"><span class="hs-identifier hs-var">optimize'</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="annot"><a href="TuringMachine.Optimization.html#optimal"><span class="hs-identifier hs-type">optimal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-216"></span><span id="optimal"><span class="annot"><span class="annottext">optimal :: Level -&gt; TuringMachine -&gt; IsChanged
</span><a href="TuringMachine.Optimization.html#optimal"><span class="hs-identifier hs-var hs-var">optimal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TuringMachine -&gt; (TuringMachine, IsChanged))
 -&gt; TuringMachine -&gt; IsChanged)
-&gt; (Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged))
-&gt; Level
-&gt; TuringMachine
-&gt; IsChanged
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="annot"><span class="annottext">(((TuringMachine -&gt; (TuringMachine, IsChanged))
  -&gt; TuringMachine -&gt; IsChanged)
 -&gt; (Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged))
 -&gt; Level
 -&gt; TuringMachine
 -&gt; IsChanged)
-&gt; (((TuringMachine, IsChanged) -&gt; IsChanged)
    -&gt; (TuringMachine -&gt; (TuringMachine, IsChanged))
    -&gt; TuringMachine
    -&gt; IsChanged)
-&gt; ((TuringMachine, IsChanged) -&gt; IsChanged)
-&gt; (Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged))
-&gt; Level
-&gt; TuringMachine
-&gt; IsChanged
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">((TuringMachine, IsChanged) -&gt; IsChanged)
-&gt; (TuringMachine -&gt; (TuringMachine, IsChanged))
-&gt; TuringMachine
-&gt; IsChanged
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TuringMachine, IsChanged) -&gt; IsChanged
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged)
</span><a href="TuringMachine.Optimization.html#optimize%27"><span class="hs-identifier hs-var">optimize'</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span id="local-6989586621679339067"><span class="annot"><a href="TuringMachine.Optimization.html#ifCanOptimize"><span class="hs-identifier hs-type">ifCanOptimize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679339067"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679339067"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span></span><span>
</span><span id="line-219"></span><span id="ifCanOptimize"><span class="annot"><span class="annottext">ifCanOptimize :: Level -&gt; TuringMachine -&gt; m TuringMachine
</span><a href="TuringMachine.Optimization.html#ifCanOptimize"><span class="hs-identifier hs-var hs-var">ifCanOptimize</span></a></span></span><span> </span><span id="local-6989586621679338882"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338882"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679338881"><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338881"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679338880"><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338880"><span class="hs-identifier hs-var">newTM</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338879"><span class="annot"><span class="annottext">IsChanged
</span><a href="#local-6989586621679338879"><span class="hs-identifier hs-var">changed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Level -&gt; TuringMachine -&gt; (TuringMachine, IsChanged)
</span><a href="TuringMachine.Optimization.html#optimize%27"><span class="hs-identifier hs-var">optimize'</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338882"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338881"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><a href="#local-6989586621679338879"><span class="hs-identifier hs-var">changed</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TuringMachine -&gt; m TuringMachine
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338880"><span class="hs-identifier hs-var">newTM</span></a></span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; m TuringMachine
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Can't optimize&quot;</span></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="TuringMachine.Optimization.html#safeOptimize"><span class="hs-identifier hs-type">safeOptimize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span>
</span><span id="line-226"></span><span id="safeOptimize"><span class="annot"><span class="annottext">safeOptimize :: Level -&gt; TuringMachine -&gt; TuringMachine
</span><a href="TuringMachine.Optimization.html#safeOptimize"><span class="hs-identifier hs-var hs-var">safeOptimize</span></a></span></span><span> </span><span id="local-6989586621679338878"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338878"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Level -&gt; TuringMachine -&gt; TuringMachine
</span><a href="TuringMachine.Optimization.html#optimize"><span class="hs-identifier hs-var">optimize</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338878"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(TuringMachine -&gt; TuringMachine)
-&gt; (TuringMachine -&gt; TuringMachine)
-&gt; TuringMachine
-&gt; TuringMachine
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine -&gt; TuringMachine
</span><a href="TuringMachine.Optimization.Safe.html#secure"><span class="hs-identifier hs-var">secure</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="TuringMachine.Optimization.html#safeOptimal"><span class="hs-identifier hs-type">safeOptimal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-229"></span><span id="safeOptimal"><span class="annot"><span class="annottext">safeOptimal :: Level -&gt; TuringMachine -&gt; IsChanged
</span><a href="TuringMachine.Optimization.html#safeOptimal"><span class="hs-identifier hs-var hs-var">safeOptimal</span></a></span></span><span> </span><span id="local-6989586621679338876"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338876"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Level -&gt; TuringMachine -&gt; IsChanged
</span><a href="TuringMachine.Optimization.html#optimal"><span class="hs-identifier hs-var">optimal</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338876"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(TuringMachine -&gt; IsChanged)
-&gt; (TuringMachine -&gt; TuringMachine) -&gt; TuringMachine -&gt; IsChanged
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine -&gt; TuringMachine
</span><a href="TuringMachine.Optimization.Safe.html#secure"><span class="hs-identifier hs-var">secure</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span id="local-6989586621679338875"><span class="annot"><a href="TuringMachine.Optimization.html#ifCanSafeOptimize"><span class="hs-identifier hs-type">ifCanSafeOptimize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679338875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679338875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span></span><span>
</span><span id="line-232"></span><span id="ifCanSafeOptimize"><span class="annot"><span class="annottext">ifCanSafeOptimize :: Level -&gt; TuringMachine -&gt; m TuringMachine
</span><a href="TuringMachine.Optimization.html#ifCanSafeOptimize"><span class="hs-identifier hs-var hs-var">ifCanSafeOptimize</span></a></span></span><span> </span><span id="local-6989586621679338874"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338874"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Level -&gt; TuringMachine -&gt; m TuringMachine
forall (m :: * -&gt; *).
MonadFail m =&gt;
Level -&gt; TuringMachine -&gt; m TuringMachine
</span><a href="TuringMachine.Optimization.html#ifCanOptimize"><span class="hs-identifier hs-var">ifCanOptimize</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338874"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(TuringMachine -&gt; m TuringMachine)
-&gt; (TuringMachine -&gt; TuringMachine)
-&gt; TuringMachine
-&gt; m TuringMachine
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine -&gt; TuringMachine
</span><a href="TuringMachine.Optimization.Safe.html#secure"><span class="hs-identifier hs-var">secure</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-keyword">newtype</span><span> </span><span id="DiffTM"><span class="annot"><a href="TuringMachine.Optimization.html#DiffTM"><span class="hs-identifier hs-var">DiffTM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DiffTM"><span class="annot"><a href="TuringMachine.Optimization.html#DiffTM"><span class="hs-identifier hs-var">DiffTM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679338868"><span id="local-6989586621679338871"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#DiffTM"><span class="hs-identifier hs-type">DiffTM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621679338866"><span class="annot"><span class="annottext">show :: DiffTM -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="TuringMachine.Optimization.html#DiffTM"><span class="hs-identifier hs-type">DiffTM</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679338864"><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338864"><span class="hs-identifier hs-var">tm1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679338863"><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338863"><span class="hs-identifier hs-var">tm2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338864"><span class="hs-identifier hs-var">tm1</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338863"><span class="hs-identifier hs-var">tm2</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><a href="TuringMachine.Optimization.html#diffTM"><span class="hs-identifier hs-type">diffTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.Level.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.html#TuringMachine"><span class="hs-identifier hs-type">TuringMachine</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="TuringMachine.Optimization.html#DiffTM"><span class="hs-identifier hs-type">DiffTM</span></a></span><span>
</span><span id="line-240"></span><span id="diffTM"><span class="annot"><span class="annottext">diffTM :: Level -&gt; TuringMachine -&gt; DiffTM
</span><a href="TuringMachine.Optimization.html#diffTM"><span class="hs-identifier hs-var hs-var">diffTM</span></a></span></span><span> </span><span id="local-6989586621679338862"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338862"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679338861"><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338861"><span class="hs-identifier hs-var">oldTM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679338860"><span class="annot"><span class="annottext">newTM :: TuringMachine
</span><a href="#local-6989586621679338860"><span class="hs-identifier hs-var hs-var">newTM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Level -&gt; TuringMachine -&gt; TuringMachine
</span><a href="TuringMachine.Optimization.html#optimize"><span class="hs-identifier hs-var">optimize</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621679338862"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338861"><span class="hs-identifier hs-var">oldTM</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span id="local-6989586621679338859"><span class="annot"><span class="annottext">Set Quadruple
</span><a href="#local-6989586621679338859"><span class="hs-identifier hs-var">oldQs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#Quadruple"><span class="hs-identifier hs-type">TuringMachine.Quadruple</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><span class="annottext">[Quadruple] -&gt; Set Quadruple
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Quadruple] -&gt; Set Quadruple) -&gt; [Quadruple] -&gt; Set Quadruple
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Quadruples -&gt; [Quadruple]) -&gt; Quadruples -&gt; [Quadruple]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338861"><span class="hs-identifier hs-var">oldTM</span></a></span><span class="annot"><span class="annottext">TuringMachine
-&gt; Getting Quadruples TuringMachine Quadruples -&gt; Quadruples
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span id="local-6989586621679338857"><span class="annot"><span class="annottext">Set Quadruple
</span><a href="#local-6989586621679338857"><span class="hs-identifier hs-var">newQs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="TuringMachine.Quadruple.html#Quadruple"><span class="hs-identifier hs-type">TuringMachine.Quadruple</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>            </span><span class="annot"><span class="annottext">[Quadruple] -&gt; Set Quadruple
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Quadruple] -&gt; Set Quadruple) -&gt; [Quadruple] -&gt; Set Quadruple
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Quadruples -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Quadruples -&gt; [Quadruple]) -&gt; Quadruples -&gt; [Quadruple]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338860"><span class="hs-identifier hs-var">newTM</span></a></span><span class="annot"><span class="annottext">TuringMachine
-&gt; Getting Quadruples TuringMachine Quadruples -&gt; Quadruples
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting Quadruples TuringMachine Quadruples
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">(TuringMachine, TuringMachine) -&gt; DiffTM
</span><a href="TuringMachine.Optimization.html#DiffTM"><span class="hs-identifier hs-var">DiffTM</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-247"></span><span>            </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338860"><span class="hs-identifier hs-var">newTM</span></a></span><span> </span><span class="annot"><span class="annottext">TuringMachine -&gt; (TuringMachine -&gt; TuringMachine) -&gt; TuringMachine
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Quadruples -&gt; Identity Quadruples)
-&gt; TuringMachine -&gt; Identity TuringMachine
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span> </span><span class="annot"><span class="annottext">((Quadruples -&gt; Identity Quadruples)
 -&gt; TuringMachine -&gt; Identity TuringMachine)
-&gt; Quadruples -&gt; TuringMachine -&gt; TuringMachine
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">[Quadruple] -&gt; Quadruples
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Quadruple -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Quadruple
</span><a href="#local-6989586621679338857"><span class="hs-identifier hs-var">newQs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Quadruple -&gt; Set Quadruple -&gt; Set Quadruple
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%5C"><span class="hs-operator hs-var">\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set Quadruple
</span><a href="#local-6989586621679338859"><span class="hs-identifier hs-var">oldQs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><span class="annottext">TuringMachine
</span><a href="#local-6989586621679338861"><span class="hs-identifier hs-var">oldTM</span></a></span><span> </span><span class="annot"><span class="annottext">TuringMachine -&gt; (TuringMachine -&gt; TuringMachine) -&gt; TuringMachine
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Quadruples -&gt; Identity Quadruples)
-&gt; TuringMachine -&gt; Identity TuringMachine
Lens' TuringMachine Quadruples
</span><a href="TuringMachine.html#quadruples"><span class="hs-identifier hs-var">quadruples</span></a></span><span> </span><span class="annot"><span class="annottext">((Quadruples -&gt; Identity Quadruples)
 -&gt; TuringMachine -&gt; Identity TuringMachine)
-&gt; Quadruples -&gt; TuringMachine -&gt; TuringMachine
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">[Quadruple] -&gt; Quadruples
forall c v. UnsafeListable c v =&gt; [v] -&gt; c
</span><a href="Containers.html#fromList"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Quadruple -&gt; [Quadruple]
forall c v. Listable c v =&gt; c -&gt; [v]
</span><a href="Containers.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Quadruple
</span><a href="#local-6989586621679338859"><span class="hs-identifier hs-var">oldQs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Quadruple -&gt; Set Quadruple -&gt; Set Quadruple
forall c. Operable c =&gt; c -&gt; c -&gt; c
</span><a href="Containers.html#%5C%5C"><span class="hs-operator hs-var">\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set Quadruple
</span><a href="#local-6989586621679338857"><span class="hs-identifier hs-var">newQs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-250"></span></pre></body></html>